<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Table</title>
    <style>
        *,
        *::after,
        *::before {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            font-size: 1rem;
            font-weight: 600;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(to right, hsl(200, 100%, 50%), hsl(175, 100%, 50%))
        }

        table,
        form {
            margin-top: 4rem;
            width: 600px;
            margin-inline: auto;

        }

        thead {
            background: black;
            color: gainsboro
        }

        th,
        td {
            padding: 5px 10px;
            text-align: left;
        }

        form {
            background-color: rgba(255, 255, 255, 0.37);
            padding: 1rem;
            border-radius: 10px;
        }

        form button {
            width: 50%;
            padding: 10px;
            background-color: black;
            color: white;
            font-weight: bold;
            margin-top: 2rem;
            margin-inline: auto;
        }

        label,
        input,
        button {
            display: block;
            font-family: inherit;

        }

        input {
            width: 100%;
            padding: 2px 10px;
            border-radius: 5px;
            min-height: 40px;
            outline: none;
            border: none;
            margin-top: 2px;
        }

        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
    </style>
</head>

<body>
    <table>
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>DOB</th>
                <th>Program</th>
                <th>Year</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <!-- Add Student Form -->

    <form>
        <div class="form-container">
            <div class="item">
                <label for="fName">
                    First Name
                </label>
                <input name="fName" id="fName" type="text">
            </div>
            <div class="item">
                <label for="lName">
                    Last Name
                </label>
                <input name="lName" id="lName" type="text">
            </div>
            <div class="item">
                <label for="dob">
                    Date of Birth
                </label>
                <input name="dob" id="dob" type="date">
            </div>
            <div class="item">
                <label for="program">
                    Program
                </label>
                <input name="program" id="program" type="text">
            </div>
            <div class="item">
                <label for="country">
                    Country
                </label>
                <input name="country" id="country" type="text">
            </div>
            <div class="item">
                <label for="year">
                    Year
                </label>
                <input name="year" id="year" type="number">
            </div>
        </div>
        <button>Submit</button>
    </form>
    <script>
        const tb = document.querySelector('tbody')
        const form = document.querySelector('form')

        function createEl(arg) {
            return document.createElement(arg)
        }

        async function fetchStudents() {
            try {
                const body = await fetch("https://dbms-dxyg.onrender.com/students")
                const data = await body.json()
                data.map(x => {
                    const newDate = new Date(x.dob)
                    const date = new Intl.DateTimeFormat('en-US', {
                        year: 'numeric',
                        month: "numeric",
                        day: "numeric"
                    }).format(newDate)

                    const row = createEl('tr')
                    const fName = createEl('td')
                    const lName = createEl('td')
                    const dob = createEl('td')
                    const program = createEl('td')
                    const year = createEl('td')

                    fName.innerText = x.fName
                    lName.innerText = x.lName
                    dob.innerText = date
                    program.innerText = x.program
                    year.innerText = x.year

                    row.appendChild(fName)
                    row.appendChild(lName)
                    row.appendChild(dob)
                    row.appendChild(program)
                    row.appendChild(year)

                    tb.appendChild(row)
                })
            } catch (err) {
                console.log(err)
            }
        }

        fetchStudents()

        form.addEventListener('submit', async e => {
            e.preventDefault()

            try {
                const formData = new FormData(e.target)
                const data = JSON.stringify(Object.fromEntries(formData))
                console.log(data)
                const res = await fetch("https://dbms-dxyg.onrender.com/students", {
                    method: "POST",
                    headers: {
                        'Content-Type':"application/json"
                    },
                    body: data
                })

                const dt = await res.json()
                window.location.reload()
                console.log(dt)
            } catch (err) {
                console.log(err)
            }
        })


    </script>
</body>

</html>